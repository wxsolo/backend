// Generated by CoffeeScript 1.6.3
define(function(require, exports, module) {
  var $, Kit, Register;
  $ = require('$');
  Kit = require('../lib/kit');
  Register = (function() {
    var $btn, $email, $errorTip, $password, $uname, bok, checkInvalid, doRegister, events, msgHandle, url;

    function Register() {
      this.init();
    }

    $uname = $('.reg-uname');

    $email = $('.reg-email');

    $password = $('.reg-password');

    $btn = $('.reg-btn');

    $errorTip = $('.error-tip');

    url = '/user/reg';

    bok = false;

    Register.prototype.init = function() {
      return events();
    };

    events = function() {
      $btn.click(function() {
        return doRegister();
      });
      $uname.focus(function() {
        return Kit.errorTip($errorTip, '', 'hide');
      });
      $email.focus(function() {
        return Kit.errorTip($errorTip, '', 'hide');
      });
      return $password.focus(function() {
        return Kit.errorTip($errorTip, '', 'hide');
      });
    };

    checkInvalid = function(data) {
      if (data.username.length < 4) {
        return Kit.errorTip($errorTip, '用户名不得小于四位!', 'show');
      } else if (!Kit.isValidEmail(data.email)) {
        Kit.errorTip($errorTip, '邮箱不合法!', 'show');
        return bok = false;
      } else if (data.password.length < 6) {
        kit.errorTip($errorTip, '密码不得小于六位!', 'show');
        return bok = false;
      } else {
        return bok = true;
      }
    };

    msgHandle = function(msg) {
      if (msg.errorCode === 201) {
        Kit.redirect('/user');
        return false;
      }
      if (msg.errorCode === 101) {
        return Kit.errorTip($errorTip, '用户名已经存在!', 'show');
      }
    };

    doRegister = function() {
      var data;
      data = {
        username: $uname.val(),
        email: $email.val(),
        password: $password.val()
      };
      if (checkInvalid(data)) {
        return $.ajax({
          url: url,
          type: 'post',
          data: data,
          success: function(msg) {
            return msgHandle(msg);
          }
        });
      }
    };

    return Register;

  })();
  return module.exports = Register;
});
