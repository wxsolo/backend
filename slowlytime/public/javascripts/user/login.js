// Generated by CoffeeScript 1.6.3
define(function(require, exports, module) {
  var $, Kit, Login;
  $ = require('$');
  Kit = require('../lib/kit');
  Login = (function() {
    var $btn, $email, $errorTip, $password, bok, checkInvalid, doLogin, events, msgHandle, url;

    function Login() {
      this.init();
    }

    $email = $('.login-email');

    $password = $('.login-password');

    $errorTip = $('.error-tip');

    $btn = $('.login-btn');

    url = '/user/login';

    bok = false;

    Login.prototype.init = function() {
      return events();
    };

    events = function() {
      $btn.click(function() {
        return doLogin();
      });
      $email.focus(function() {
        return Kit.errorTip($errorTip, '', 'hide');
      });
      return $password.focus(function() {
        return Kit.errorTip($errorTip, '', 'hide');
      });
    };

    checkInvalid = function(data) {
      if (!Kit.isValidEmail(data.email)) {
        Kit.errorTip($errorTip, '邮箱地址错误！', 'show');
        bok = false;
      } else if (data.password.length < 6) {
        Kit.errorTip($errorTip, '密码小于6位', 'show');
        bok = false;
      } else {
        bok = true;
      }
      return bok;
    };

    msgHandle = function(msg) {
      if (msg.errorCode === 202) {
        return Kit.redirect('/user');
      } else if (msg.errorCode === 103) {
        return Kit.errorTip($errorTip, '用户不存在！', 'show');
      } else if (msg.errorCode === 104) {
        return Kit.errorTip($errorTip, '用户名或密码错误!', 'show');
      }
    };

    doLogin = function() {
      var data;
      data = {
        email: $email.val(),
        password: $password.val()
      };
      if (checkInvalid(data)) {
        return $.ajax({
          url: url,
          type: 'post',
          data: data,
          success: function(msg) {
            return msgHandle(msg);
          }
        });
      }
    };

    return Login;

  })();
  return module.exports = Login;
});
