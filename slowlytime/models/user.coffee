# Generated by CoffeeScript 1.6.3
connection = require '../lib/mysql'
connection.connect()

User = 
    register: (info,next) ->
        connection.query 'INSERT INTO user SET ?', info, (err, result)->
            next err, null if err
            next null, result
    get: (info,next) ->
        connection.query "SELECT id,name,gravator,password,email FROM user WHERE email = ?", [info.email], (err,result) ->
            if err
                next err, null
            else
                next null, result

module.exports = User
# save user
###User.save = (info,next)->
  user = new User
  user.register info,next
User::register = (info,next)->
  self = @
  self.name = info.name
  self.email = info.email
  self.password = info.password
  self.save()
  next null,self

# check user
User.get = (user,next)->
  User.findOne {email:user.email},(err,dbUser)->
    return next err if err
    if not dbUser?
      next err,null
    else
      next err,dbUser
# update user
User.modify = (args,next)->
  User.findOne({email:args.email}).exec (err,user)->
    try
      if args.password is undefined
          user.name = args.name
          user.motto = args.motto
      else
          user.password = args.password
          user.email = args.email
      user.save()
      next null,user
    catch err
      next err,null
###
